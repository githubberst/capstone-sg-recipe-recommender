<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recipe Recommender</title>
</head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap5-toggle@5.0.4/css/bootstrap5-toggle.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap5-toggle@5.0.4/js/bootstrap5-toggle.ecmas.min.js"></script>
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/main.css') }}">
<body>

<div class="body-box container">
    <form name="ingredients_list"  method="post" action="/results" enctype = "multipart/form-data">
        

        <div class="row">
        <div class="col">
        <h1 class="top-heading">I have these ingredients:</h1>  
        
        <label class="switch">
        <input type="checkbox" id="submitType" name="submitType" onchange="if(document.getElementById('submitType').checked){carousel.to(1)}else{carousel.to(0)}"/>
        <span class="sliderbar round"></span>
        </label>
        </div>
        </div>


        <div id="myCarousel" class="carousel slide">
        <div class="carousel-inner">
        <div class="carousel-item active">


        <div class="row gx-5">
        <div class="col-6">
        <div class="row">
        <div class="cat-header">
        Veg
        </div>
        </div>
        <div class="row">
        <div class="col-6 cat-content p-3">
        <input type="checkbox" id="cabbage" name="ingredients" value="cabbage">
        <label for="cabbage">cabbage</label><br>

        <input type="checkbox" id="carrot" name="ingredients" value="carrot">
        <label for="carrot">carrot</label><br>

        <input type="checkbox" id="chilli" name="ingredients" value="chilli">
        <label for="chilli">chilli</label><br>

        <input type="checkbox" id="coriander" name="ingredients" value="coriander">
        <label for="coriander">coriander</label><br>

        <input type="checkbox" id="cucumber" name="ingredients" value="cucumber">
        <label for="cucumber">cucumber</label><br>

        <input type="checkbox" id="garlic" name="ingredients" value="garlic">
        <label for="garlic">garlic</label><br>
        
        </div>

        <div class="col-6 cat-content p-3">

        <input type="checkbox" id="ginger" name="ingredients" value="ginger">
        <label for="ginger">ginger</label><br>
        
        <input type="checkbox" id="onion" name="ingredients" value="onion">
        <label for="onion">onion</label><br>

        <input type="checkbox" id="parsley" name="ingredients" value="parsley">
        <label for="parsley">parsley</label><br>


        <input type="checkbox" id="potato" name="ingredients" value="potato">
        <label for="potato">potato</label><br>

        <input type="checkbox" id="spring_onions" name="ingredients" value="spring_onions">
        <label for="spring_onions">spring onions</label><br>

        <input type="checkbox" id="tomato" name="ingredients" value="tomato">
        <label for="tomato">tomato</label><br>
        
        </div>

        </div>

        </div>
        <div class="col">
        <div class="cat-header">
        Carb
        </div>
        <div class="cat-content p-3">

        <input type="checkbox" id="noodle" name="ingredients" value="noodle">
        <label for="noodle">noodle</label><br>

        <input type="checkbox" id="rice" name="ingredients" value="rice">
        <label for="rice">rice</label><br>
        </div>
        </div>
        <div class="col">
        <div class="cat-header">
        Fruits
        </div>
        <div class="cat-content p-3">

        <input type="checkbox" id="apple" name="ingredients" value="apple">
        <label for="apple">apple</label><br>

        <input type="checkbox" id="lemon" name="ingredients" value="lemon">
        <label for="lemon">lemon</label><br>
        <input type="checkbox" id="lime" name="ingredients" value="lime">
        <label for="lime">lime</label><br>
        <input type="checkbox" id="orange" name="ingredients" value="orange">
        <label for="orange">orange</label><br>
        </div>
        </div>
        </div>

        <div class="row gx-5">
        <div class="col-6">
        <div class="row">
        <div class="cat-header">
        Meat
        </div>
        </div>
        <div class="row">
        <div class="col-6 cat-content p-3">

        <input type="checkbox" id="beef" name="ingredients" value="beef">
        <label for="beef">beef</label><br>

        <input type="checkbox" id="chicken" name="ingredients" value="chicken">
        <label for="chicken">chicken</label><br>
        </div>

        <div class="col-6 cat-content p-3">

        <input type="checkbox" id="fish" name="ingredients" value="fish">
        <label for="fish">fish</label><br>

        <input type="checkbox" id="pork" name="ingredients" value="pork">
        <label for="pork">pork</label><br>

        <input type="checkbox" id="prawns" name="ingredients" value="prawns">
        <label for="prawns">prawns</label><br>
        
        </div>
        </div>
        </div>

        <div class="col-6">
        <div class="row">
        <div class="cat-header">
        Others
        </div>
        </div>
        <div class="row">
        <div class="col-6 cat-content p-3">

        
        <input type="checkbox" id="egg" name="ingredients" value="egg">
        <label for="egg">egg</label><br>


        <input type="checkbox" id="honey" name="ingredients" value="honey">
        <label for="honey">honey</label><br>

        <input type="checkbox" id="milk" name="ingredients" value="milk">
        <label for="milk">milk</label><br>

        </div>

        <div class="col-6 cat-content p-3">

        <input type="checkbox" id="mushroom" name="ingredients" value="mushroom">
        <label for="mushroom">mushroom</label><br>


        <input type="checkbox" id="peanut" name="ingredients" value="peanut">
        <label for="peanut">peanut</label><br>

        <input type="checkbox" id="stock" name="ingredients" value="stock">
        <label for="stock">stock</label><br>


        <input type="checkbox" id="yogurt" name="ingredients" value="yogurt">
        <label for="yogurt">yogurt</label><br>

        </div>
        </div>
        </div>
        </div>


        </div>


        <div class="carousel-item">
        <div class="col-12">
        <img id="uploadBtn" width=100 src="{{url_for('static', filename='images/upload.svg')}}" onclick="document.getElementById('uploadImg').click();"/>
        &nbsp;&nbsp;&nbsp;upload an image of the ingredients in jpg or png
        <script type="text/javascript">
        var globalRatio = {}
        var loadImgSrc = ""
            function PreviewImage() {
                loadImgSrc = ""
                container = document.getElementById("imageContainer")
                container.innerHTML='<img id="uploadPreview" />'
                var oFReader = new FileReader();
                oFReader.readAsDataURL(document.getElementById("uploadImg").files[0]);

                oFReader.onload = function (oFREvent) {
                    loadImgSrc = oFREvent.target.result;
                };

                document.getElementById("uploadPreview").src = "{{url_for('static', filename='images/giphy.gif')}}";
                document.getElementById("uploadPreview").width = "50"
                var fileSelect = document.getElementById('uploadImg');      

                var files = fileSelect.files;
                var formData = new FormData();
                var file = files[0];
                formData.append('file-select', file, file.name);
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/image_detection', true);
                xhr.onload = function (e) {
                if (xhr.status === 200) {
                    var jsonData = JSON.parse(xhr.response);
                    console.log(jsonData)
                    document.getElementById("uploadPreview").src = loadImgSrc
                    document.getElementById("uploadPreview").removeAttribute("width")
                    annotateAll(jsonData)
                } else {
                    alert('An error occurred!');
                    console.log(e)
                    document.getElementById("uploadPreview").removeAttribute("src")
                    document.getElementById("uploadPreview").removeAttribute("width")
                }
                };
                xhr.send(formData);
            };

        function annotateAll(jsonData)
        {
            checkboxes = document.querySelectorAll('input[type="checkbox"]')
             for (var checkbox of checkboxes) {  
                checkbox.checked = false 
            }  
            imgPrv = document.getElementById("uploadPreview")
            globalRatio = getRatio(jsonData.image.height,jsonData.image.width,imgPrv.height,imgPrv.width)
            if (jsonData.predictions.length > 0) {
            jsonData.predictions.forEach(annotateImage)
            }
            else {

                container = document.getElementById("imageContainer")
                box_element = document.createElement("div")
                box_element.style.cssText = 'position:absolute;top:0px;left:0px;width:100%;height:100%;color:white;text-align:left;vertical-align:top;-webkit-text-stroke: 1px red;padding:5px'
                box_element.textContent = " Ingredient Not Recognized"
                container.appendChild(box_element)
            }
        }

        function annotateImage(value,index,array)
        {
            console.log(globalRatio)
            console.log(value)
            container = document.getElementById("imageContainer")
            bounding_box = getBoundingBox(value.x,value.y,value.width,value.height)
            box_element = document.createElement("div")
            box_element.style.cssText = 'position:absolute;border:1px solid red;top: '+bounding_box.y1+'%;left: '+bounding_box.x1+'%;width: '+bounding_box.w+'%;height: '+bounding_box.h+'%;color:white;text-align:left;vertical-align:top;'
            box_element.innerHTML = "<mark>"+value.class+"</mark>"
            console.log(box_element)
            container.appendChild(box_element)
            const checked = document.querySelector('input[id="'+value.class+'"]')
            checked.checked = true
            
        }

        function getRatio(new_h,new_w,old_h,old_w)
        {
            return {h_ratio: new_h/100, w_ratio: new_w/100}
        }

        function getBoundingBox(x,y,width,height)
        {
            x1 = (x - width / 2) / globalRatio.w_ratio
            x2 = (x + width / 2) / globalRatio.w_ratio
            y1 = (y - height / 2) / globalRatio.h_ratio
            y2 = (y + height / 2) / globalRatio.h_ratio
            return {x1: x1, x2: x2, y1: y1, y2: y2, w: (width / globalRatio.w_ratio), h: (height / globalRatio.h_ratio)}
        }

        </script>
        <input type=file id="uploadImg" name="uploadImg" onchange="PreviewImage()" />
        <br/><br/>
        <div id="imageContainer" style="text-align:left;position:relative;float:left;">
        <img id="uploadPreview" />
        </div>
        

        </div>
        </div>
        </div>
        </div>

        
        
        
        
        
        
        

        
        
        
        
        

        
        
        
        
        <!--

        <h1>Or, Upload Image</h1>
       <input type="file" />
        <h1>Sampling:</h1>
        <table>
            <tr>
                <td> Select One </td>
                <td>
                    <fieldset id="sampling_type">
                        <input type="radio" value="" name="sampling_type"> I want to use as many ingredients as possible in one recipe <br/>
                        <input type="radio" value="" name="sampling_type"> I want a few recipes with different combinations of ingredients
                    </fieldset>
                </td>
            </tr>
        </table>

!-->
        <input type="hidden" name="difficulty" value="super easy" /> 
        <input type="hidden" name="difficulty" value="easy" /> 
        <input type="hidden" name="difficulty" value="medium" /> 
        <input type="hidden" name="difficulty" value="hard" /> 
        <input type="hidden" name="reco_range" value="5" /> 
        <input type="hidden" name="steps" value="10" /> 
        <input type="hidden" name="ingrno" value="13" /> 
        <input type="hidden" name="prept" value="15" /> 
        <div class="col-12 gy-2"></div>
        <div class="col-12 note-text">note: common condiments and herbs are assumed present in your kitchen.</div>
        <input class="col-12 rounded-pill p-3 submit-button border-0" type="submit" name="submit" value="+ Create My Recipe"/>
    </form>

</div>
</body>
<script>

const myCarouselElement = document.querySelector('#myCarousel')

const carousel = new bootstrap.Carousel(myCarouselElement, {
  interval: 2000,
  touch: false
})


</script>
</html>